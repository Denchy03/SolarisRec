@page "/deck"

@using SolarisRec.Core.Card
@using SolarisRec.UI.Components.Dropdown
@using SolarisRec.UI.Provdiders
@using SolarisRec.UI.UIModels

<MudGrid>
    <MudItem xs="2">
        <MudMultiSelectDropdown @ref="factionDropdown" DropdownItems="FactionDropdownItems" Label="Factions" @bind-SelectedValues="@SelectedFactions.Selected" />
    </MudItem>
    <MudItem xs="2">
        <MudMultiSelectDropdown @ref="cardTypeDropdown" DropdownItems="CardTypeDropdownItems" Label="Card Type" @bind-SelectedValues="@SelectedCardTypes.Selected" />
    </MudItem>
    <MudItem xs="2">
        <MudMultiSelectDropdown @ref="crcDropdown" DropdownItems="ConvertedResourceCostDropdownItems" Label="Converted Cost" @bind-SelectedValues="@SelectedConvertedResourceCosts.Selected" />
    </MudItem>
    <MudItem xs="2">
        <MudMultiSelectDropdown @ref="talentsDropdown" DropdownItems="TalentDropdownItems" Label="Talents" @bind-SelectedValues="@SelectedTalents.Selected" />
    </MudItem>
    <MudItem xs="2">
        <MudMultiSelectDropdown @ref="keywordDropown" DropdownItems="KeywordDropdownItems" Label="Keyword" @bind-SelectedValues="@SelectedKeywords.Selected" />
    </MudItem>
    <MudItem xs="2">
        <MudButton OnClick="ClearFilters">Clear Filters</MudButton>
    </MudItem>
</MudGrid>

<MudGrid>
    <MudItem xs="2">
        <img src="@(ImgSrc)" width=200 height=300>
    </MudItem>

    <MudItem xs="1"></MudItem>

    <MudItem xs="9">
        <MudTable Items="@Cards"
                  T="Card"
                  OnRowClick="AddToDeck"
                  ServerData="@(new Func<TableState, Task<TableData<Card>>>(GetCardsFiltered))"
                  Hover="true"
                  Breakpoint="Breakpoint.Sm"
                  RightAlignSmall="true"
                  @ref="table">
            <ToolBarContent>
                <MudSpacer />
                <MudTextField T="string" ValueChanged="@(searchTerm => OnSearchByName(searchTerm))" Placeholder="Search by name"
                              Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                              IconSize="Size.Medium" Class="mt-0" Label="Search by name" @ref="searchByName"></MudTextField>
                <MudTextField T="string" ValueChanged="@(abilitySearchTerm => OnSearchByAbility(abilitySearchTerm))" Placeholder="Search by ability"
                              Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                              IconSize="Size.Medium" Class="mt-0" Label="Search by ability" @ref="searchByAbility"></MudTextField>
            </ToolBarContent>

            <HeaderContent>
                <MudContainer MaxWidth="MudBlazor.MaxWidth.Large">
                    <MudTh Style="width: 100px;">Name</MudTh>
                    <MudTh Style="width: 100px;">Factions</MudTh>
                    <MudTh Style="width: 100px;">Type</MudTh>
                    <MudTh Style="width: 50px;">Cost</MudTh>
                    <MudTh Style="width: 50px;">Talent</MudTh>
                    <MudTh Style="width: 30px;">AV</MudTh>
                    <MudTh Style="width: 30px;">HV</MudTh>
                    <MudTh Style="width: 500px;">Ability</MudTh>
                </MudContainer>
            </HeaderContent>
            <RowTemplate>
                <MudContainer MaxWidth="MudBlazor.MaxWidth.Large" @onmouseover="@(() => UpdateImageSrc(context))">
                    <MudTd DataLabel="Name" Style="width: 100px;">@context.Name</MudTd>
                    <MudTd DataLabel="Factions" Style="width: 100px;">@context.Factions</MudTd>
                    <MudTd DataLabel="CardType" Style="width: 100px;">@context.Type</MudTd>
                    <MudTd DataLabel="Cost" Style="width: 50px;">
                        @for (int i = 0; i < @context.Costs.Count; i++)
                        {
                            for (int j = 0; j < @context.Costs[i].Quantity; j++)
                            {
                                <img src="@ResourceIconImageLinkProvider.Provide(@context.Costs[i])" width="20" height="20">
                            }
                        }
                    </MudTd>
                    <MudTd DataLabel="Talent" Style="width: 50px;">
                        @for (int i = 0; i < @context.Talents.Count; i++)
                        {
                            for (int j = 0; j < @context.Talents[i].Quantity; j++)
                            {
                                <img src="@TalentIconImageLinkProvider.Provide(@context.Talents[i])" width="20" height="20">
                            }
                        }
                    </MudTd>
                    <MudTd DataLabel="AttackValue" Style="width: 30px;">@context.AttackValue</MudTd>
                    <MudTd DataLabel="HealthValue" Style="width: 30px;">@context.HealthValue</MudTd>
                    <MudTd DataLabel="Ability" Style="width: 500px;">@context.Ability</MudTd>
                </MudContainer>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="@pageSizeOption" RowsPerPageString="Cards per page" />
            </PagerContent>
        </MudTable>
    </MudItem>
</MudGrid>



<MudTable Items="@MainDeck"
          T="DeckItem"
          OnRowClick="RemoveFromDeck"
          Hover="true"
          Breakpoint="Breakpoint.Sm"
          Style="width=1000px; float: left;">

    <HeaderContent>
        <MudTh Style="width: 20px;">Q</MudTh>
        <MudTh Style="width: 100px;">Name</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Quantity" Style="width: 20px;">@context.Quantity</MudTd>
        <MudTd DataLabel="Name" Style="width: 100px;">@context.Name</MudTd>
    </RowTemplate>
</MudTable>



<MudTable Items="@MissionDeck"
          T="Card"
          OnRowClick="RemoveFromMissionDeck"
          Hover="true"
          Breakpoint="Breakpoint.Sm"
          Style="width=1000px; float: left;">

    <HeaderContent>
        <MudTh Style="width: 100px;">Name</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name" Style="width: 100px;">@context.Name</MudTd>
    </RowTemplate>
</MudTable>



<MudTable Items="@Sideboard"
          T="Card"
          OnRowClick="RemoveFromSideboard"
          Hover="true"
          Breakpoint="Breakpoint.Sm"
          Style="width=1000px; float: left;">

    <HeaderContent>
        <MudTh Style="width: 100px;">Name</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name" Style="width: 100px;">@context.Name</MudTd>
    </RowTemplate>
</MudTable>

